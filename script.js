const boardEl=document.getElementById('board');const statusEl=document.getElementById('status');const resetBtn=document.getElementById('reset');const modeSelect=document.getElementById('mode');const firstSelect=document.getElementById('first');const scoreXEl=document.getElementById('scoreX');const scoreOEl=document.getElementById('scoreO');const scoreDEl=document.getElementById('scoreD');let board=Array(9).fill(null);let current='X';let mode=modeSelect.value;let scores={X:0,O:0,D:0};let gameOver=true;let allowInput=true;const WINLINES=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];function init(){boardEl.innerHTML='';for(let i=0;i<9;i++){const cell=document.createElement('div');cell.className='cell';cell.setAttribute('role','button');cell.setAttribute('aria-label',`Cell ${i+1}`);cell.dataset.index=i;cell.addEventListener('click',onCellClick);boardEl.appendChild(cell)}mode=modeSelect.value;setStatus('Ready. Choose mode and press Reset to start.');updateScoresUI()}function render(){const cells=boardEl.querySelectorAll('.cell');cells.forEach((el,idx)=>{el.textContent=board[idx]||'';el.classList.toggle('x',board[idx]==='X');el.classList.toggle('o',board[idx]==='O');el.classList.toggle('disabled',!!board[idx]||gameOver===true)})}function onCellClick(e){if(gameOver||!allowInput)return;const i=Number(e.currentTarget.dataset.index);if(board[i])return;if(mode==='pvc'&&current==='O')return;makeMove(i,current)}function makeMove(i,player){board[i]=player;render();const res=checkWinner(board);if(res){finishGame(res);return}current=player==='X'?'O':'X';setStatus(`${current}'s turn`);if(mode==='pvc'&&current==='O'){allowInput=false;setTimeout(()=>{const move=bestMove(board,'O',6);makeMove(move,'O');allowInput=true},300)}}function checkWinner(b){for(const[a,b1,c]of WINLINES){if(b[a]&&b[a]===b[b1]&&b[a]===b[c]){return{winner:b[a],line:[a,b1,c]}}}if(b.every(cell=>cell!==null))return{draw:true};return null}function finishGame(result){gameOver=true;if(result.draw){setStatus("It's a draw!");scores.D+=1}else{setStatus(`${result.winner} wins!`);scores[result.winner]+=1;result.line.forEach(i=>{const cell=boardEl.querySelector(`.cell[data-index="${i}"]`);if(cell)cell.style.boxShadow='0 6px 18px rgba(0,0,0,0.6), 0 0 0 4px rgba(255,255,255,0.02) inset'})}updateScoresUI()}function bestMove(b,player,depthLimit=6){if(b.every(c=>c===null)){return 4}let bestScore=-Infinity;let move=null;for(let i=0;i<9;i++){if(b[i]===null){b[i]=player;const score=minimax(b,0,false,player,depthLimit);b[i]=null;if(score>bestScore){bestScore=score;move=i}}}return move??board.findIndex(c=>c===null)}function minimax(b,depth,isMaximizing,aiPlayer,depthLimit){const res=checkWinner(b);if(res){if(res.draw)return 0;return res.winner===aiPlayer?10-depth:depth-10}if(depth>=depthLimit)return 0;const currentPlayer=isMaximizing?aiPlayer:(aiPlayer==='X'?'O':'X');let best=isMaximizing?-Infinity:Infinity;for(let i=0;i<9;i++){if(b[i]===null){b[i]=currentPlayer;const val=minimax(b,depth+1,!isMaximizing,aiPlayer,depthLimit);b[i]=null;if(isMaximizing)best=Math.max(best,val);else best=Math.min(best,val)}}return best}function setStatus(text){statusEl.textContent=text}function updateScoresUI(){scoreXEl.textContent=scores.X;scoreOEl.textContent=scores.O;scoreDEl.textContent=scores.D}function resetGame(newMode){board=Array(9).fill(null);gameOver=false;allowInput=true;current='X';mode=modeSelect.value;if(firstSelect.value==='computer'&&mode==='pvc'){current='O';setStatus('Computer (O) is thinking...');render();allowInput=false;setTimeout(()=>{const move=bestMove(board,'O',6);makeMove(move,'O');allowInput=true},350)}else{setStatus(`${current}'s turn`)}render()}resetBtn.addEventListener('click',()=>resetGame());modeSelect.addEventListener('change',()=>{setStatus('Mode changed. Press Reset to start a new round.')});firstSelect.addEventListener('change',()=>setStatus('Who goes first changed. Press Reset.'));window.addEventListener('keydown',(e)=>{if(e.key==='r'||e.key==='R')resetGame()});init();render();
